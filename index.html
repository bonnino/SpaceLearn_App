<!DOCTYPE html>
<html>

<head>
  <base target="_top"> 
  <!-- Intégration de bootstrap CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">

  <meta charset="UTF-8">

  <!-- Styles -->
  <style>
      /* Le contenu de Stylesheet.html sera inséré ici */
    <?!= include('Stylesheet'); ?>
  </style>

</head>

<body>
  <!--
     --- PARTIE FIXE ---
  -->
   {{NAVBAR}}
  <div class="container">
    <h1 class="mt-4">Quiz Flashcards</h1>
    <div id="category-selection">
      <h2>Choisir une catégorie :</h2>
      <select id="category-list" class="form-select form-select-lg">
        <option value="-1">Sélectionner une catégorie</option>
      </select>
    </div>

    <div id="study-section" class="study-section"></div>
    <div id="flashcard-container" class="flashcard-container">
    <div id="sens-controls" class="mb-3 btn-group" role="group" aria-label="Sélection du sens des cartes">
        <input type="radio" class="btn-check" name="sens" id="sensQtoR" value="QtoR" autocomplete="off" checked>
        <label class="btn btn-outline-secondary btn-sm" for="sensQtoR">
            Sens : Q->R
        </label>

        <input type="radio" class="btn-check" name="sens" id="sensRtoQ" value="RtoQ" autocomplete="off">
        <label class="btn btn-outline-secondary btn-sm" for="sensRtoQ">
            Sens : R->Q
        </label>
    </div>
    <div id="flashcard-content" class="flashcard-content">
    </div>
    <div id="flashcard-controls" class="flashcard-controls">
        <button id="prev-card-btn" class="btn btn-secondary btn-lg" onclick="prevFlashcard()" disabled>
          <i class="fas fa-chevron-left"></i> <span class="visually-hidden">Carte précédente</span>
        </button>
        <div id="study-card-number" class="text-center mb-3 h4"> / </div>     
        <button id="next-card-btn" class="btn btn-primary btn-lg" onclick="nextFlashcard()">
          <span class="visually-hidden">Carte suivante</span> <i class="fas fa-chevron-right"></i>
        </button>
        <button class="btn btn-success btn-lg" onclick="promouvoirCarte(G_flashcardsData[G_currentCardIndex].rowNumber)">
          <i class="fa-solid fa-thumbs-up"></i> <span class="visually-hidden">Je le savais</span>
        </button>
        <button class="btn btn-danger btn-lg" onclick="retrograderCarte(G_flashcardsData[G_currentCardIndex].rowNumber)">
          <i class="fa-solid fa-thumbs-down"></i> <span class="visually-hidden">Je ne le savais pas</span>
        </button>      
        <button id="nextcopy-card-btn" class="btn btn-primary btn-lg" onclick="copierDansPressePapier()">
          <span class="visually-hidden">Copier dans presse-papier</span> <i class="fas fa-clipboard"></i>
        </button>
      </div>        
    </div>
 
  </div>


  <!-- 
   --- PARTIE DYNAMIQUE ---
  -->
<?!= include('clientSideCode'); ?>
<script>


   // Variables globales
let G_flashcardsData;
let G_boites;
let G_currentBoiteId = -1;
let G_currentCardIndex = 0;
let G_currentCategoryId = -1;

// Déclaration des éléments DOM pour les : catégories, boites, flashcards
// const categorySelection = document.getElementById('category-selection'); // Récupère l'élément ici
const G_elt_categoryList = document.getElementById('category-list');
const G_elt_studySection = document.getElementById('study-section'); // Assure-toi d'avoir un élément avec cet ID
const G_elt_cardNumberDisplay = document.getElementById('study-card-number'); // Récupère l'élément pour afficher le nombre

const G_elt_flashcardContainer = document.getElementById('flashcard-container');
const G_elt_sensControls = document.getElementById('sens-controls'); // Récupère le conteneur des radios
const G_elt_flashcardContent = document.getElementById('flashcard-content');

const G_elt_prevCardBtn = document.getElementById('prev-card-btn');
const G_elt_nextCardBtn = document.getElementById('next-card-btn');

  // Charge les données au chargement de la page
document.addEventListener('DOMContentLoaded', onLoad);

// Fonction appelée au chargement de la page
function onLoad() {
  google.script.run.withSuccessHandler(handleCategories).getCategories();
  google.script.run.withSuccessHandler(handleBoites).getBoites();
  // inutile const G_elt_sensControls = document.getElementById('sens-controls');
  if (G_elt_sensControls) {
    G_elt_sensControls.addEventListener('change', () => {
      showFlashcard(G_currentCardIndex);
    });
  }
}
</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous">
  </script>

</body>

</html>